class Justify{justifyLocalStorage="__jtf_notification_message";href_default="javascript:void(0)";defaultErrorMessage="Please contact to admin for more report";errorClass={field:"is-invalid",span:"invalid-feedback",attr:'role="alert"'};constructor(e=null){"undefined"!=typeof window?window._jtf=this:"undefined"!=typeof global&&(global._jtf=this),this.debug=!!e&&void 0!==e.debug&&e.debug,this.showBorderError=!(e&&!1===e.showBorderError),this.underfieldError=!!(e&&!0===e.underfieldError),this.justifyError=!!(e&&!0===e.justifyError),this.errorField=!(e&&!1===e.errorField),this.splitMessage=!!(e&&!0===e.splitMessage),this.refreshCsrfToken=!!(e&&!0===e.refreshCsrfToken),this.pleaseContactToAdmin=e&&e.defaultErrorMessage?e.defaultErrorMessage:this.defaultErrorMessage,this.loaderClass=e&&e.loaderClass?e.loaderClass:"loader-div",this.csrfTokenUrl=e&&e.csrfTokenUrl?e.csrfTokenUrl:null,this.csrfToken=e&&e.csrfToken?e.csrfToken:null,this.csrfTokenName=e&&e.csrfTokenName?e.csrfTokenName:null,this.customJustify=e&&e.customJustify?e.customJustify:null,this.ajaxTimeout=e&&e.ajaxTimeout?e.ajaxTimeout:0,_jtf.rewriteCsrfToken(),_jtf.init()}init(){$(document).on("click","a",_jtf.dataMethodPost),$(document).on("submit",".ajaxForm",_jtf.submitAjax),$(document).on("change","input,textarea,select",_jtf.removeError),_jtf.addMetaTag(),_jtf.justifyNotyMessage(),_jtf.checkHrefHash()}generateUniqueId(){return Math.floor(26*Math.random())+Date.now()}xhrStatusCodeMessages(){return{404:function(e){return _jtf.notify("error","404"),!1}}}addMetaTag(){_jtf.csrfToken||_jtf.rewriteCsrfToken()}checkHrefHash(){$(document).find("a").each(function(e,r){let t=$.trim($(r).attr("href"));("#"===t||"undefined"===t||void 0===t||""===t)&&$(r).attr("href",_jtf.href_default)})}dataMethodPost(e){let r=$(this).data("method")??"get",t=$(this).data("class"),s=$(this).attr("href");if("#"===s||"undefined"===s||void 0===s||""===s||s===_jtf.href_default||-1!==s.indexOf(":void"))return!1;if("get"===r.toLowerCase()&&"ajaxForm"!==t)return!0;{e.preventDefault(),_jtf.uniqueId&&$(document).find("#"+_jtf.uniqueId).remove(),_jtf.uniqueId=_jtf.generateUniqueId();let a=$(this).data("confirm-message");if(a&&void 0!==a&&!confirm(a))return!1;_jtf.loader();let n="<form action='"+s+"' method='"+r+"' id='"+_jtf.uniqueId+"' class='"+t+"'><input type='hidden' name='"+_jtf.csrfTokenName+"' value='"+_jtf.csrfToken+"'></form>";$(this).parent().append(n),$(document).find("#"+_jtf.uniqueId).css({position:"absolute",display:"none"});let o=$(this).data(),i=Object.keys(o).length;$.each(o,function(e,r){i--,-1===$.inArray(e,["method","class"])&&$(document).find("#"+_jtf.uniqueId).append("<input type='hidden' name='"+e+"' value='"+r+"'>"),i<=0&&$("#"+_jtf.uniqueId).submit()})}}successResponse(e,r){if(!0===r.status){if(void 0!==r.url&&""!==$.trim(r.url)&&null!=r.url)return void 0!==r.message&&""!==$.trim(r.message)&&null!=r.message&&localStorage.setItem(_jtf.justifyLocalStorage,$.trim(r.message)),window.location.href=r.url,!1;if(void 0!==r.message&&""!==$.trim(r.message)&&null!=r.message&&_jtf.notify("info",$.trim(r.message)),void 0!==r.function&&""!==$.trim(r.function)&&null!=r.function){let t=$.trim(r.function);if(t){let s=t.split("."),a=null;void 0!==r.data&&""!==r.data&&(a=r.data);let n={form:e,param:a};_jtf.callDynamicFn(s,n)}}_jtf.loader(!1)}else if(!1===r.status)""!==$.trim(r.message)&&_jtf.notify("error",r.message),_jtf.loader(!1);else if(_jtf.debug){let o=r;"string"!=typeof r&&(o=JSON.stringify(r)),_jtf.notify("error",o)}else _jtf.notify("error",_jtf.pleaseContactToAdmin);_jtf.checkHrefHash()}failedResponse(e,r){if(_jtf.rewriteCsrfToken(),r.responseJSON&&r.responseJSON.errors){let t=r.responseJSON.errors,s="";$.each(t,function(r,t){if(r.includes(".")){let a=r.split("."),n="";$.each(a,function(e,r){0!=e?n+="["+r+"]":n+=r}),r=n,n=""}let o='<span class="'+_jtf.errorClass.span+'">'+t[0]+"</span>",i=t[0];if(console.log(_jtf.errorField),_jtf.errorField){let l=r.replace("_"," ").replace("-"," ");s+=l+": ",i=l+": "+t[0]}_jtf.splitMessage&&_jtf.notify("error",i),s+=t[0]+"</br>",_jtf.underfieldError&&(e.find('input[name="'+r+'"]').parent().append(o),e.find('select[name="'+r+'"]').parent().append(o),e.find('select[name="'+r+'[]"]').parent().append(o),e.find('textarea[name="'+r+'"]').parent().append(o)),_jtf.showBorderError&&(e.find('input[name="'+r+'"]').addClass(_jtf.errorClass.field),e.find('select[name="'+r+'"]').addClass(_jtf.errorClass.field),e.find('select[name="'+r+'[]"]').addClass(_jtf.errorClass.field),e.find('textarea[name="'+r+'"]').addClass(_jtf.errorClass.field))}),_jtf.splitMessage||_jtf.notify("error",s)}else r.responseJSON&&r.responseJSON.message?_jtf.notify("error",r.responseJSON.message):r.responseJSON&&_jtf.debug?_jtf.notify("error",r.statusText):_jtf.notify("error",_jtf.pleaseContactToAdmin);return _jtf.checkHrefHash(),!1}submitAjax(e){e.preventDefault();let r=$(this);_jtf.csrfToken&&r.find('input[name="'+_jtf.csrfTokenName+'"]').remove(),_jtf.loader(),r.find("span."+_jtf.errorClass.span).remove(),r.find("input").removeClass(_jtf.errorClass.field),r.find("select").removeClass(_jtf.errorClass.field),r.find("textarea").removeClass(_jtf.errorClass.field);let t=void 0!==r.attr("method")?r.attr("method"):"get",s=r.attr("action");r.find("input,select,textarea").each(function(){$(this).attr("name")&&void 0!==$(this).attr("name")&&($(this).attr("name",$(this).attr("name").replace(/'/g,"")),$(this).attr("name",$(this).attr("name").replace(/"/g,"")))});let a=new FormData(this);$.ajaxSetup({headers:{"X-CSRF-TOKEN":_jtf.csrfToken,"X-CSRFTOKEN":_jtf.csrfToken},contentType:!1,processData:!1,timeout:_jtf.ajaxTimeout,statusCode:_jtf.xhrStatusCodeMessages()}),$.ajax({url:s,method:t.toUpperCase(),data:a,success:function(e){_jtf.successResponse(r,e)},error:function(e){_jtf.failedResponse(r,e)}})}loader(e=!0){let r=$("."+_jtf.loaderClass);r.length&&(e?r.show():r.hide())}callDynamicFn(e,r,t=null){$.each(e,function(s,a){"string"==typeof a&&(t=null!=t?t[a]:window[a]),s+1==e.length&&t(r)})}justifyNotyMessage(){let e=localStorage.getItem(_jtf.justifyLocalStorage);void 0!==e&&""!==$.trim(e)&&null!=e&&setTimeout(function(){_jtf.notify("info",e),localStorage.removeItem(_jtf.justifyLocalStorage)},1500)}removeError(){$(this).hasClass(_jtf.errorClass.field)&&$(this).removeClass(_jtf.errorClass.field)}notify(e,r){_jtf.loader(!1),e="info"===e?"information":e,_jtf.justifyError&&r&&(_jtf.customJustify||alert(e+": "+r),_jtf.customJustify&&"function"==typeof _jtf.customJustify&&_jtf.customJustify(e,r))}rewriteCsrfToken(){_jtf.refreshCsrfToken&&_jtf.csrfTokenUrl&&$.get(_jtf.csrfTokenUrl,function(e){if(e.token){_jtf.csrfToken=e.token;let r=$('meta[name="'+_jtf.csrfTokenName+'"]');r.length&&r.attr("content",_jtf.csrfToken),$("form").each(function(e,r){$(r).find('input[name="'+_jtf.csrfTokenName+'"]').val(_jtf.csrfToken)})}}).fail(function(){_jtf.notify("error","Url Not Found")})}}
